{% extends 'layouts/base.html' %}

{% block title %}Proposition rapide - BanaCommunity{% endblock %}

{% block content %}
{% include "/home/bana_community/banaProject/bana/accounts/templates/account/profile/nav_profile.html" %}

<div class="bg-gray-100 min-h-screen p-6">
  <div class="container mx-auto">
    <h2 class="text-3xl font-bold text-center text-gray-800 mb-6">Proposer un trajet (rapide)</h2>

    {% if messages %}
    <ul class="mb-4">
      {% for message in messages %}
      <li class="text-sm p-2 rounded bg-yellow-100 text-yellow-900">{{ message }}</li>
      {% endfor %}
    </ul>
    {% endif %}

    <ul class="flex border-b border-gray-300">
        <li class="mr-4">
            <a href="{% url 'proposed_traject' %}"
                class="inline-block px-4 py-2 text-gray-600 hover:text-indigo-600 hover:border-b-2 hover:border-indigo-400 transition">
                Proposer un trajet
            </a>
        </li>

        {% if request.user.profile.service == "yaya" %}
        <li class="mr-4">
          <a href="{% url 'simple_proposed_traject' %}"
              class="inline-block px-4 py-2 text-gray-700 font-medium border-b-2 border-indigo-600">
              Trajet simple
          </a>
        </li>
        {% endif %}
        <li class="mr-4">
            <a href="{% url 'my_proposed_trajects' %}"
                class="inline-block px-4 py-2 text-gray-600 hover:text-indigo-600 hover:border-b-2 hover:border-indigo-400 transition">
                Mes propositions de trajets
            </a>
        </li>
        <li>
            <a href="{% url 'my_matchings_proposed' %}"
                class="inline-block px-4 py-2 text-gray-600 hover:text-indigo-600 hover:border-b-2 hover:border-indigo-400 transition">
                Mes matchings
            </a>
        </li>
    </ul>

    <form method="POST" action="{% url 'simple_proposed_traject' %}" class="bg-white p-6 rounded shadow-md space-y-6">
      {% csrf_token %}
      <div>
        <label for="id_start_adress" class="block font-medium text-gray-700">Ville de dÃ©part</label>
        {{ form.start_adress }}
      </div>
      <div>
         <ul id="start-suggestion-list"
          class="bg-white border border-gray-300 rounded-md shadow-md mt-1 max-h-48 overflow-auto"></ul>
      </div>

      <div>
        <label for="id_transport_modes" class="block font-medium text-gray-700">Modes de transport</label>
        {{ form.transport_modes }}
      </div>

      <div>
        <label for="id_tr_weekdays" class="block font-medium text-gray-700">Jours de la semaine</label>
        {{ form.tr_weekdays }}
      </div>

      <div>
        <label for="id_date_debut" class="block font-medium text-gray-700">Date de dÃ©but</label>
        {{ form.date_debut }}
      </div>

      <div>
        <button type="submit"
          class="w-full py-3 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition duration-200">
          ðŸ’¾ Enregistrer cette proposition rapide
        </button>
      </div>
    </form>
  </div>
</div>

<script>
    document.querySelectorAll("#start_adress").forEach((inputField) => {
        inputField.addEventListener("input", async (event) => {
            const query = event.target.value;

            if (query.length < 3) return; // Skip queries with fewer than 3 characters

            try {
                const url = `{% url 'autocomplete' %}?query=${query}`; // Use the correct query value
                const response = await fetch(url);
                if (!response.ok) throw new Error("Error fetching suggestions");

                const data = await response.json();
                const suggestions = data.suggestions || [];

                // Determine which suggestion list to populate
                const suggestionListId = event.target.id === "start_adress" ? "start-suggestion-list" : "end-suggestion-list";
                const suggestionList = document.getElementById(suggestionListId);

                // Populate suggestions list
                suggestionList.innerHTML = ""; // Clear previous suggestions
                suggestions.forEach((suggestion) => {
                    const li = document.createElement("li");
                    li.textContent = suggestion;
                    li.classList.add("cursor-pointer", "p-2", "hover:bg-gray-100");
                    li.addEventListener("click", () => {
                        inputField.value = suggestion; // Set input value
                        suggestionList.innerHTML = ""; // Clear suggestions
                    });
                    suggestionList.appendChild(li);
                });
            } catch (error) {
                console.error("Error fetching suggestions:", error);
            }
        });
    });


</script>
{% endblock %}

{# Password settings fragment — injecté dans #security-password via HTMX #}
<div class="max-w-md space-y-5">

  {# Astuce : si tu utilises un form Django, tu peux afficher ses erreurs globales ici #}
  {% if form and form.non_field_errors %}
    <div class="p-3 rounded bg-red-50 text-red-700 text-sm">
      {{ form.non_field_errors }}
    </div>
  {% endif %}

  <form
    method="post"
    action="{% url 'accounts:account_change_password' %}"
    hx-post="{% url 'accounts:account_change_password' %}"
    hx-target="#security-password" hx-swap="innerHTML"
    class="space-y-4">
    {% csrf_token %}

    <div>
      <label class="block text-sm font-semibold text-gray-900 mb-1">{% trans "Mot de passe actuel" %}</label>
      <input type="password" name="oldpassword" autocomplete="current-password" required
             class="w-full border border-brand px-4 py-2 shadow-sm rounded-full focus:ring-brand focus:border-brand" />
      {% if form and form.errors.oldpassword %}
        <p class="mt-1 text-xs text-red-600">{{ form.errors.oldpassword|striptags }}</p>
      {% endif %}
    </div>

    <div>
      <label class="block text-sm font-semibold text-gray-900 mb-1">{% trans "Nouveau mot de passe" %}</label>
      <input type="password" name="password1" autocomplete="new-password" required
             class="w-full border border-brand px-4 py-2 shadow-sm rounded-full focus:ring-brand focus:border-brand" />
      {% if form and form.errors.password1 %}
        <p class="mt-1 text-xs text-red-600">{{ form.errors.password1|striptags }}</p>
      {% endif %}
      <p class="mt-1 text-xs text-gray-500">
        {% trans "8 caractères minimum, mélangez lettres/chiffres/symboles." %}
      </p>
    </div>

    <div>
      <label class="block text-sm font-semibold text-gray-900 mb-1">{% trans "Confirmer le nouveau mot de passe" %}</label>
      <input type="password" name="password2" autocomplete="new-password" required
             class="w-full border border-brand px-4 py-2 shadow-sm rounded-full focus:ring-brand focus:border-brand" />
      {% if form and form.errors.password2 %}
        <p class="mt-1 text-xs text-red-600">{{ form.errors.password2|striptags }}</p>
      {% endif %}
    </div>

    <div class="flex items-center justify-between pt-2">
      <a href="{% url 'account_reset_password' %}"
         class="text-sm text-brand hover:underline">{% trans "Mot de passe oublié ?" %}</a>

      <button type="submit"
              class="inline-flex items-center gap-2 rounded-full bg-brand text-white px-5 py-2 text-sm font-semibold hover:bg-brand-dark focus:outline-none focus-visible:ring-2 focus-visible:ring-brand">
        {% trans "Mettre à jour" %}
      </button>
    </div>
  </form>
</div>

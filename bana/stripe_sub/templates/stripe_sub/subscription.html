{% extends "allauth/layouts/base.html" %}
{% load i18n static %}

{% block head_title %}Mon abonnement{% endblock head_title %}
{% block content %}
<section class="section profile">
  <div class="container" data-aos="fade-up" data-aos-delay="100">
    <div class="max-w-3xl mx-auto">

      <!-- Carte parent conforme au layout commun -->
      <div class="bg-white shadow-lg rounded-xl px-4 py-8 sm:p-8 md:p-12 lg:p-16 space-y-8">

        <h2 class="text-xl font-semibold text-brand">Mon abonnement</h2>

        <div class="grid gap-6 grid-cols-1">

          {# â€”â€”â€” Description (Parent / Yaya) â€”â€”â€” #}
          <section class="rounded-xl border border-gray-200 p-4 space-y-4">
            {% if request.user.profile.service == "Parent" %}

              <!-- ğŸ” Description Parent (texte original conservÃ©) -->
              <div>
                <p class="text-gray-700 leading-relaxed">
                  En tant que <span class="font-semibold">Parent</span>, votre objectif principal est de <strong>rechercher de lâ€™aide pour les trajets de vos enfants</strong>. 
                  Vous pouvez ainsi trouver facilement les trajets proposÃ©s par des Yayas ou dâ€™autres parents pour vos besoins quotidiens.
                </p>
                <ul class="my-4 space-y-2 text-gray-700">
                  <li><span class="font-medium text-brand-200">Rechercher un trajet</span><br>trouvez les trajets proposÃ©s par des Yayas ou dâ€™autres parents pour vos enfants.</li>
                  <li><span class="font-medium text-brand-200">Proposer un trajet</span><br>si vous effectuez un trajet, vous pouvez Ã©galement prendre en charge dâ€™autres enfants pour aider la communautÃ©.</li>
                </ul>
                <p class="mt-3 text-gray-600 italic">Ainsi, vous bÃ©nÃ©ficiez Ã  la fois dâ€™un soutien pour vos dÃ©placements et participez Ã  la solidaritÃ© entre familles</p>
              </div>

            {% else %}

              <!-- ğŸ” Description Yaya (texte original conservÃ©) -->
              <div>
                <p class="text-gray-700 leading-relaxed">
                  Avec <span class="font-semibold">Yaya</span>, vous pouvez proposer diffÃ©rents types de trajets adaptÃ©s aux besoins des parents :
                </p>
                <ul class="mt-3 space-y-2 text-gray-700">
                  <li>âœ… <span class="font-medium">Trajet classique</span> : un trajet dâ€™un point <strong>A</strong> vers un point <strong>B</strong>, que ce soit pour une seule journÃ©e ou de maniÃ¨re rÃ©guliÃ¨re sur une pÃ©riode dÃ©finie.</li>
                  <li>âœ… <span class="font-medium">Trajet simplifiÃ©</span> : vous indiquez uniquement un <strong>lieu de dÃ©part</strong>, sans destination prÃ©cise, pour permettre dâ€™aider nâ€™importe quel parent dans la zone.</li>
                </ul>
              </div>

            {% endif %}
          </section>

          {# â€”â€”â€” Bloc abonnement (actif / inactif) â€”â€”â€” #}
          <section class="rounded-xl border border-green-200 bg-green-50 p-6 space-y-4">

            {% if active_subscription %}
              <div class="grid sm:grid-cols-2 gap-6">

                <div>
                  <p class="block text-sm font-bold text-brand uppercase mb-1">Produit</p>
                  <p class="font-semibold text-gray-800">{{ active_subscription.product_name }}</p>
                </div>

                {% comment "" %}
                
                {% endcomment %}<div>
                  <p class="block text-sm font-bold text-brand uppercase mb-1">Statut</p>
                  {% if active_subscription.is_active %}
                    <span class="inline-flex items-center px-3 py-1 rounded-full bg-green-100 text-green-800 text-sm font-medium">âœ… Actif</span>
                  {% else %}
                    <span class="inline-flex items-center px-3 py-1 rounded-full bg-red-100 text-red-800 text-sm font-medium">âŒ Inactif</span>
                  {% endif %}
                </div>

                <div>
                  <p class="block text-sm font-bold text-brand uppercase mb-1">Prix</p>
                  <p class="font-medium"><span class="font-bold">{{ active_subscription.price }} â‚¬</span> / an</p>
                </div>

                <div>
                  <p class="block text-sm font-bold text-brand uppercase mb-1">PÃ©riode de l'abonnement</p>
                  <p>{{ active_subscription.current_period_start|date:"d/m/Y" }} â” {{ active_subscription.current_period_end|date:"d/m/Y" }}</p>
                </div>

                {# â€”â€”â€” Conserve ton commentaire dâ€™origine â€”â€”â€” #}
                {% comment "RÃ©cupÃ©rer la variable current_period_end" %}
                <div>
                  <p class="block text-sm font-bold text-brand uppercase mb-1">Date de fin</p>
                  <p>
                    {% if active_subscription.current_period_end %}
                      {{ active_subscription.current_period_end|date:"d/m/Y" }}
                    {% else %}
                      Non dÃ©finie
                    {% endif %}
                  </p>
                </div>
                {% endcomment %}

              </div>

            {% else %}

              <div>
                <p class="text-gray-600">Vous nâ€™avez pas encore dâ€™abonnement actif.</p>
              </div>

              <div class="pt-2">
                <form method="post" action="{% url 'create_checkout_session' %}">
                  {% csrf_token %}
                  <input type="hidden" name="price_id" value="{{ price.id }}">
                  <button type="submit" 
                          class="inline-flex items-center px-5 py-2 rounded-full bg-brand text-white hover:bg-brand-dark font-semibold transition">
                    Sâ€™abonner pour {{ product_price|floatformat:0 }} â‚¬/an
                  </button>
                </form>
              </div>

            {% endif %}
          </section>

        </div>

      </div>
    </div>
  </div>
</section>
{% endblock content %}
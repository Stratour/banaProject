<!-- validations/templates/validations/validation_list.html -->
{% extends 'base.html' %} {# Assurez-vous d'avoir un template de base #}
{% load static %} {# Pour HTMX si vous l'utilisez #}

{% block title %}Gestion des Validations d'Inscriptions{% endblock %}

{% block content %}
<h1 class="text-3xl font-bold mb-6 text-gray-800">Demandes de Validation d'Inscriptions</h1>

{% if messages %}
    <ul class="mb-4">
        {% for message in messages %}
            <li class="p-3 rounded-md {% if message.tags == 'success' %}bg-green-100 text-green-800{% elif message.tags == 'warning' %}bg-yellow-100 text-yellow-800{% elif message.tags == 'error' %}bg-red-100 text-red-800{% endif %}">
                {{ message }}
            </li>
        {% endfor %}
    </ul>
{% endif %}

{% if validation_requests %}
    <div class="bg-white shadow-md rounded-lg overflow-hidden">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Utilisateur
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Statut
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Date de Demande
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Actions
                    </th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% for req in validation_requests %}
                <tr id="validation-row-{{ req.pk }}">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">{{ req.user.username }}</div>
                        <div class="text-sm text-gray-500">{{ req.user.email }}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        {% if req.is_validated %}
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                Validé
                            </span>
                        {% else %}
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                                En attente
                            </span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        {{ req.created_at|date:"d M Y H:i" }}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        {% if not req.is_validated %}
                            <form hx-post="{% url 'validations:validate_user' req.pk %}"
                                  hx-target="#validation-row-{{ req.pk }}"
                                  hx-swap="outerHTML"
                                  class="inline-block mr-2">
                                {% csrf_token %}
                                <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                                    Valider
                                </button>
                            </form>
                            <form hx-post="{% url 'validations:reject_user' req.pk %}"
                                  hx-target="#validation-row-{{ req.pk }}"
                                  hx-swap="outerHTML"
                                  class="inline-block">
                                {% csrf_token %}
                                <button type="submit" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2">
                                    Rejeter
                                </button>
                            </form>
                        {% else %}
                            <span class="text-gray-500">Actions effectuées</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% else %}
    <p class="text-gray-600">Aucune demande de validation en attente.</p>
{% endif %}

{# Inclure HTMX si vous l'utilisez #}
<script src="https://unpkg.com/htmx.org@1.9.10" integrity="sha384-D1Kt99CQGqfggBgiYX7sPcaK+lfmWP<span>/</span>poIzW9<span>/</span><span>+</span>Lw7SfRzKzJpC3OHT2B1hZe" crossorigin="anonymous"></script>
{% endblock %}


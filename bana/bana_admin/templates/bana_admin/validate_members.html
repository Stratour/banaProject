{% extends 'layouts/base.html' %}
{% block title %} Validation des membres - BanaCommunity{% endblock %}

{% block content %}
<div class="bg-gray-100 min-h-screen p-6">
    <div class="container mx-auto">

        <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center"> Validation des membres de la communauté</h2>
        {% if messages %}
        <ul class="mb-4">
            {% for message in messages %}
            <li class="text-sm p-2 rounded bg-yellow-100 text-yellow-900">
                {{ message }}
            </li>
            {% endfor %}
        </ul>
        {% endif %}

        {% include "./layout/nav_admin.html" %}
      </div>

<h2>Liste des profils d'utilisateurs</h2>

<table>
    <thead>
        <tr>
            <th>Utilisateur</th>
            <th>Nom</th>
            <th>Prénom</th>
            <th>CI Vérifiée</th>
            <th>BVM Vérifié</th>
            <th>DOC BVM</th>
            <th>Profil vérifié</th>
        </tr>
    </thead>
    <tbody>
        {% for user in profiles %}
        <tr>
            <td>
                {{ user.user.username }}
            </td>

            <td>{{ user.verified_first_name|default:"N/A" }}</td>
            <td>{{ user.verified_last_name|default:"N/A" }}</td>
            <td>
                {% if user.ci_is_verified %}
                    <span class="verified-badge verified-true">Oui</span>
                {% else %}
                    <span class="verified-badge verified-false">Non</span>
                {% endif %}
            </td>
            <td>
                {% if user.bvm_is_verified %}
                    <span class="verified-badge verified-true">Oui</span>
                {% else %}
                    <span class="verified-badge verified-false">Non</span>
                {% endif %}
            </td>
            <td>
	      {% if user.document_bvm %}
                <a href="{{ user.document_bvm.url }}" target="_blank" class="btn btn-info">Afficher</a>
                <a href="{{ user.document_bvm.url }}" download class="btn btn-success">Télécharger</a>
              {% else %}
	        <span class="verified-badge verified-false">Non</span>
              {% endif %}
            </td>
            <td>
                {% if user.prfl_is_verified %}
                    <span class="verified-badge verified-true">Oui</span>
                {% else %}
                  {% comment %}
                    <span class="verified-badge verified-false">Non</span>
                  {% endcomment %}
		   
		  <form method="post" action="{% url 'bana_admin:verify_profile_prfl' user.id %}">
		    {% csrf_token %}
		    <button type="submit" class="verify-button">Valider Profil</button>
	          </form>
                {% endif %}
	    </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="13">Aucun profil non-vérifié disponible pour le moment.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</div>

<style>
    /* Styles basiques pour une meilleure lisibilité.
       Vous devriez déplacer ceci dans un fichier CSS externe pour un vrai projet. */
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    th, td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
    }
    th {
        background-color: #f2f2f2;
        font-weight: bold;
    }
    tr:nth-child(even) {
        background-color: #f9f9f9;
    }
    img.user.picture {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        object-fit: cover;
    }
    /* Styles pour les badges de vérification */
    .verified-badge {
        display: inline-block;
        padding: 3px 8px;
        border-radius: 12px;
        font-size: 0.8em;
        font-weight: bold;
        color: white;
        text-align: center;
    }
    .verified-true {
        background-color: #28a745; /* Vert pour vérifié */
    }
    .verified-false {
        background-color: #dc3545; /* Rouge pour non vérifié */
    }
    .verified-unknown {
        background-color: #ffc107; /* Jaune pour inconnu/en attente */
        color: #343a40; /* Texte foncé pour le jaune */
    }
/* Nouveau style pour le bouton de vérification */
    .verify-button {
        background-color: #007bff; /* Bleu pour l'action */
        color: white;
        padding: 6px 10px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.9em;
    }
    .verify-button:hover {
        background-color: #0056b3;
    }
    .disabled-button {
        background-color: #cccccc;
        cursor: not-allowed;
</style>

{% endblock %}
